<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="matthew-sword&#39;s blog">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="">
  
    
  <title>关于系统底层的杂烩 | Record&amp;Think</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>Record&Think</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>关于系统底层的杂烩</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017年12月15日</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/sundry/">sundry</a>
  </div>



            
            
          </div>
          <h1 id="关于系统底层的杂烩"><a href="#关于系统底层的杂烩" class="headerlink" title="关于系统底层的杂烩"></a>关于系统底层的杂烩</h1><h2 id="操作系统启动过程（-）"><a href="#操作系统启动过程（-）" class="headerlink" title="操作系统启动过程（##）"></a>操作系统启动过程（##）</h2><h3 id="1、通电后从主板ROM上读取BIOS，进行系统硬件自检"><a href="#1、通电后从主板ROM上读取BIOS，进行系统硬件自检" class="headerlink" title="1、通电后从主板ROM上读取BIOS，进行系统硬件自检"></a>1、通电后从主板ROM上读取BIOS，进行系统硬件自检</h3><ul>
<li>BIOS烧录在主板的ROM上</li>
<li>硬件自检若出现故障，电脑会发出蜂鸣声</li>
</ul>
<p>###2、依照启动顺序将电脑控制权交给下一阶段启动程序</p>
<ul>
<li>依照Boot Priority Order的顺序将控制权给下一个外部存储设备</li>
</ul>
<h3 id="3、读取主引导记录（MBR）"><a href="#3、读取主引导记录（MBR）" class="headerlink" title="3、读取主引导记录（MBR）"></a>3、读取主引导记录（MBR）</h3><ul>
<li><p>计算机读取该设备的第一个扇区（前512字节）</p>
<p><strong>主引导记录结构</strong></p>
<ul>
<li><p>1-446字节：调用操作系统的机器码</p>
</li>
<li><p>447-510字节：分区表</p>
</li>
<li><p>511-512字节：主引导签名记录（0x550xAA），表明该设备适用于启动的</p>
</li>
</ul>
<p><strong>分区表结构</strong>，分区表一共64字节，分成四个<strong>主分区</strong>，每一项（16字节）组成如下</p>
<ul>
<li><p>1字节：0x80表示该主分区为<strong>激活分区</strong>，控制权要交给它，四个主分区里面只能有<strong>一个是激活</strong>的。</p>
</li>
<li><p>2-4字节：主分区第一个扇区所在物理位置（柱面、磁头、扇区号）</p>
</li>
<li><p>5字节：主分区类型</p>
</li>
<li><p>6-8字节：主分区最后一个扇区的物理位置</p>
</li>
<li><p>9-12字节：主分区第一个扇区的逻辑地址</p>
</li>
<li><p>13-16字节：主分区的扇区总数</p>
<p>扇区总数决定了这个主分区的长度。也就是说，一个主分区的扇区总数最多不超过2的32次方。如果每个扇区为512个字节，就意味着单个分区最大不超过2TB。</p>
</li>
</ul>
</li>
</ul>
<h3 id="4、硬盘启动"><a href="#4、硬盘启动" class="headerlink" title="4、硬盘启动"></a>4、硬盘启动</h3><ul>
<li><p>计算机的控制权交到存储设备（一般为硬盘）的某个分区</p>
<p><strong>此处分为3种情况</strong></p>
<ul>
<li><p>卷引导记录</p>
<p>计算机会读取激活分区的第一个扇区，叫做卷引导记录（VBR）。卷引导记录存有操作系统在这个分区里的位置</p>
</li>
<li><p>扩展分区和逻辑分区</p>
<p>随着硬盘越来越大，四个主分区已经不够了，需要更多的分区。但是，分区表只有四项，因此规定<strong>有且仅有一个</strong>区可以被定义成”扩展分区”（Extended partition）。所谓”扩展分区”，就是指这个区里面又分成多个区。这种<strong>分区里面的分区</strong>，就叫做”逻辑分区”（logical partition）。<a href="http://www.ruanyifeng.com/blog/2013/02/booting.html" target="_blank" rel="external">具体过程看此处</a></p>
<p>似乎很少通过这种方式启动操作系统。如果操作系统确实安装在扩展分区，一般采用下一种方式启动。</p>
<p>​</p>
</li>
<li><p>启动管理器</p>
<p>在这种情况下，计算机读取”主引导记录”前面446字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的”启动管理器”（boot loader），由用户选择启动哪一个操作系统。比如 grub</p>
<h3 id="5、操作系统"><a href="#5、操作系统" class="headerlink" title="5、操作系统"></a>5、操作系统</h3></li>
</ul>
</li>
<li><p>控制权转交给操作系统后，操作系统的内核首先被载入内存。</p>
</li>
</ul>
<p>​             以Linux系统为例，先载入/boot目录下面的kernel。内核加载成功后，第一个运行的程序是/sbin/init。它根据配置文件（Debian系统是/etc/initab）产生init进程。这是Linux启动后的第一个进程，pid进程编号为1，其他进程都是它的后代。然后，init线程加载系统的各个模块，比如窗口程序和网络程序，直至执行/bin/login程序，跳出登录界面，等待用户输入用户名和密码。</p>
<p>​                                                                                                       参考自<a href="http://www.ruanyifeng.com/blog/2013/02/booting.html" target="_blank" rel="external">阮一峰的网络日志</a></p>
<h2 id="机械硬盘结构"><a href="#机械硬盘结构" class="headerlink" title="机械硬盘结构"></a>机械硬盘结构</h2><p><img src="hdd.jpg" alt="hdd"></p>
<p>机械硬盘主要由以下几部分组成：机械手臂（Boom）,磁头（Head）,转轴（Spindle），盘片（Platter）组成，在实际应用中又将盘片分成了磁道（Track），扇区（Sector）和柱面（Cylinder）。每一个盘片的结构如图</p>
<p><img src="plater.png" alt="plater"></p>
<h3 id="磁道"><a href="#磁道" class="headerlink" title="磁道"></a>磁道</h3><p>​         每个盘片的每个盘面被划分成多个狭窄的同心圆环，数据就是存储在这样的同心圆环上，我们将这样的圆环称为磁道(Track)，每个盘面可以划分多个磁道。在每个盘面的最外圈，离盘心最远的地方是“0”磁道，向盘心方向依次增长为1磁道，2磁道，等等。硬盘数据的存放就是从最外圈开始。</p>
<h3 id="扇区"><a href="#扇区" class="headerlink" title="扇区"></a>扇区</h3><p>每个磁道划分成若干弧段，每段称为一个扇区(Sector)。扇区是硬盘上存储的物理单位。从DOS时代起，每扇区是128×22＝512字节，现在已经成了业界不成文的规定。另外扇区的编号是从1开始，而不是0。</p>
<h3 id="柱面"><a href="#柱面" class="headerlink" title="柱面"></a>柱面</h3><p>柱面是抽象出来的一个逻辑概念，前面说过，离盘心最远的磁道为0磁道，依此往里为1磁道，2磁道，3磁道….，不同面上相同磁道编号则组成了一个圆柱面，即所称的柱面(Cylinder)。</p>
<h3 id="簇"><a href="#簇" class="headerlink" title="簇"></a>簇</h3><p>物理相邻的若干个扇区称为簇。<strong>操作系统读写磁盘的基本单位是扇区，而文件系统的基本单位是簇(Cluster)</strong>。在Windows下，随便找个几字节的文件，在其上面点击鼠标右键选择属性，看看实际大小与占用空间两项内容，如大小：15 字节 (15 字节)， 占用空间：4.00 KB (4，096 字节)。这里的占用空间就是你机器分区的簇大小，因为<strong>再小的文件都会占用空间，逻辑基本单位是4K</strong>，所以都会占用4K。 簇一般有这几类大小 4K，8K，16K，32K，64K等。簇越大存储性能越好，但空间浪费严重。簇越小性能相对越低，但空间利用率高。NTFS格式的文件系统簇的大小为4K。</p>
<p>​                                                                                                                        参考自<a href="http://blog.csdn.net/xingjiarong/article/details/46312571" target="_blank" rel="external">csdn博客</a></p>
<h2 id="MBR和GPT"><a href="#MBR和GPT" class="headerlink" title="MBR和GPT"></a>MBR和GPT</h2><p>由于磁盘容量越来越大，传统的MBR分区表（主引导记录）已经不能满足大容量磁盘的需求。传统的MBR分区表只能识别磁盘前面的2.2TB左右的空间，对于后面的多余空间只能浪费掉了，而对于单盘4TB的磁盘，只能利用一半的容量。因此，才有了GPT（全局唯一标识分区表）。</p>
<h3 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h3><p>GPT：<strong>GUID Partition Table</strong></p>
<p>GTP分区格式则较为新颖，也是为了逐渐取代MBR而生。谈到GTP分区，就不得不说到UEFI(是什么的缩写？)，UEFI也是为了取代历史悠久的BIOS而出现的。GUID分区表格式，之所以被称作UEFI，是因为<strong>该分区格式为硬盘上的每一个分区都分配了“唯一”的数据标识符，或者称作”GUID”</strong>，意为一个随机长度的字符串，这样的随机性和长度组合，<strong>基本可以保障世界上每一个GPT的分区都不会相同</strong>。GPT分区没有MBR分区的限制，比如GPT的分区可以超越2TB的容量限制，并且分区的个数没有数量上限。而此时唯一的限制，就是操作系统对GPT分区的限制，比如，在WINDOWS系统条件下，GPT划分最多的分区数量为128，但是相应的，GPT分区也不再需要像MBR分区那样，为了多个分区而必须建立扩展分区。</p>
<h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><p>GPT分区通常为了保持对MBR分区的兼容性，从而包含一份所谓的”保护性MBR分区表“，这意味着如果你使用老版本的磁盘工具读取GPT分区，那么工具通常会将GPT分区视为一整块都是扩展分区的MBR硬盘。这一兼容机制是为了保证老版本的磁盘工具不会将GPT分区视为未分区磁盘，从而错误的为GPT重新进行MBR分区操作，而破坏原有数据。</p>
<p>​                                                                                                                       参考自<a href="http://www.wuliaole.com/post/difference_between_GPT_and_MBR/" target="_blank" rel="external">无聊小博</a></p>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#关于系统底层的杂烩"><span class="toc-number">1.</span> <span class="toc-text">关于系统底层的杂烩</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#操作系统启动过程（-）"><span class="toc-number">1.1.</span> <span class="toc-text">操作系统启动过程（##）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、通电后从主板ROM上读取BIOS，进行系统硬件自检"><span class="toc-number">1.1.1.</span> <span class="toc-text">1、通电后从主板ROM上读取BIOS，进行系统硬件自检</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、读取主引导记录（MBR）"><span class="toc-number">1.1.2.</span> <span class="toc-text">3、读取主引导记录（MBR）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、硬盘启动"><span class="toc-number">1.1.3.</span> <span class="toc-text">4、硬盘启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、操作系统"><span class="toc-number">1.1.4.</span> <span class="toc-text">5、操作系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#机械硬盘结构"><span class="toc-number">1.2.</span> <span class="toc-text">机械硬盘结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#磁道"><span class="toc-number">1.2.1.</span> <span class="toc-text">磁道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扇区"><span class="toc-number">1.2.2.</span> <span class="toc-text">扇区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#柱面"><span class="toc-number">1.2.3.</span> <span class="toc-text">柱面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#簇"><span class="toc-number">1.2.4.</span> <span class="toc-text">簇</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MBR和GPT"><span class="toc-number">1.3.</span> <span class="toc-text">MBR和GPT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GPT"><span class="toc-number">1.3.1.</span> <span class="toc-text">GPT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#兼容性"><span class="toc-number">1.3.2.</span> <span class="toc-text">兼容性</span></a></li></ol></li></ol></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>


</body>
</html>
